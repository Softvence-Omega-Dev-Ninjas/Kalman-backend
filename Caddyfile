api.pravaruka.sk {
    # Socket.IO path
    reverse_proxy /socket.io/* app:5000 {
        header_up X-Real-IP {remote}
        header_up X-Forwarded-For {remote}
        header_up X-Forwarded-Proto {scheme}
        header_up Host {host}

        header_up Access-Control-Allow-Origin "https://pravaruka.sk"
        header_up Access-Control-Allow-Credentials "true"
        header_up Access-Control-Allow-Methods "GET, POST, OPTIONS"
        header_up Access-Control-Allow-Headers "*"

        transport http {
            versions h2c 1.1
        }
    }

    # Normal API requests
    reverse_proxy /* app:5000 {
        header_up X-Real-IP {remote}
        header_up X-Forwarded-For {remote}
        header_up X-Forwarded-Proto {scheme}
        header_up Host {host}
    }
}

pravaruka.sk {
    root * /var/www/dist
    try_files {path} /index.html
    file_server
    header {
        Cache-Control "public, max-age=31536000, immutable"
    }
}
